!function(e,t){"function"==typeof define&&define.amd?define(["exports","b"],t):"object"==typeof exports&&"string"!=typeof exports.nodeName?t(exports,require("b")):t(e.commonJsStrict={},e.b)}(this,function(e,t){function n(e){if(e in z)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=_.length;n--;)if(e=_[n]+t,e in z)return e}function i(e){e=e||{};for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?e[o]=i({},n[o]):e[o]=n[o])}return e}function o(e,t,n){var i;return function(){var o=this,r=arguments,a=function(){i=null,n||e.apply(o,r)},s=n&&!i;clearTimeout(i),i=setTimeout(a,t),s&&e.apply(o,r)}}function r(e){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange")}function a(e,t,n){if("string"==typeof t){var i=t;t={},t[i]=n}for(var o in t)e.style[o]=t[o]}function s(e){var t=e.points,n=document.createElement("div"),i=document.createElement("img"),o=t[2]-t[0],r=t[3]-t[1];return n.classList.add("croppie-result"),n.appendChild(i),a(i,{left:-1*t[0]+"px",top:-1*t[1]+"px"}),i.src=e.url,a(n,{width:o+"px",height:r+"px"}),n}function l(e,t){var n=t.points,i=n[0],o=n[1],r=n[2]-n[0],a=n[3]-n[1],s=t.circle,l=document.createElement("canvas"),u=l.getContext("2d"),c=r,p=a;return t.outputWidth&&t.outputHeight&&(c=t.outputWidth,p=t.outputHeight),l.width=c,l.height=p,s&&(u.save(),u.beginPath(),u.arc(c/2,p/2,c/2,0,2*Math.PI,!0),u.closePath(),u.clip()),u.drawImage(e,i,o,r,a,0,0,c,p),l.toDataURL()}function u(e){var t,n=new Image;return t=new Promise(function(t,i){n.onload=function(){setTimeout(function(){t(n)},1)},n.src=e})}function c(){var e,t,n,i,o=this,r=["croppie-container"],s=o.options.viewport.type?"cr-vp-"+o.options.viewport.type:null;o.data={},o.elements={},e=o.elements.boundary=document.createElement("div"),n=o.elements.viewport=document.createElement("div"),t=o.elements.img=document.createElement("img"),i=o.elements.overlay=document.createElement("div"),e.classList.add("cr-boundary"),a(e,{width:o.options.boundary.width+"px",height:o.options.boundary.height+"px"}),n.classList.add("cr-viewport"),s&&n.classList.add(s),a(n,{width:o.options.viewport.width+"px",height:o.options.viewport.height+"px"}),t.classList.add("cr-image"),i.classList.add("cr-overlay"),o.element.appendChild(e),e.appendChild(t),e.appendChild(n),e.appendChild(i),o.element.classList.add(r),o.options.customClass&&o.element.classList.add(o.options.customClass),f.call(this),o.options.showZoom&&m.call(o)}function p(e){this.options.showZoom&&(this.elements.zoomer.value=parseFloat(e).toFixed(2))}function m(){function e(){g.call(a),i=new M(a.elements.img),o=a.elements.viewport.getBoundingClientRect(),r=I.parse(a.elements.img)}function t(){d.call(a,{value:parseFloat(l.value),origin:i||new M(a.elements.img),viewportRect:o||a.elements.viewport.getBoundingClientRect(),transform:r||I.parse(a.elements.img)})}function n(n){var i=n.deltaY/-2e3,o=a._currentZoom+i;n.preventDefault(),e(),p.call(a,o),t()}var i,o,r,a=this,s=a.elements.zoomerWrap=document.createElement("div"),l=a.elements.zoomer=document.createElement("input");s.classList.add("cr-slider-wrap"),l.type="range",l.classList.add("cr-slider"),l.step="0.01",l.value=1,a.element.appendChild(s),s.appendChild(l),a._currentZoom=1,a.elements.zoomer.addEventListener("mousedown",e),a.elements.zoomer.addEventListener("touchstart",e),a.elements.zoomer.addEventListener("input",t),a.elements.zoomer.addEventListener("change",t),a.options.mouseWheelZoom&&(a.elements.boundary.addEventListener("mousewheel",n),a.elements.boundary.addEventListener("DOMMouseScroll",n))}function d(e){var t=this,n=e.transform,i=e.viewportRect,o=e.origin;t._currentZoom=e.value,n.scale=t._currentZoom;var r=h.call(t,i),s=r.translate,l=r.origin;n.x>=s.maxX&&(o.x=l.minX,n.x=s.maxX),n.x<=s.minX&&(o.x=l.maxX,n.x=s.minX),n.y>=s.maxY&&(o.y=l.minY,n.y=s.maxY),n.y<=s.minY&&(o.y=l.maxY,n.y=s.minY);var u={};u[X]=n.toString(),u[Z]=o.toString(),a(t.elements.img,u),H.call(t),w.call(t)}function h(e){var t=this,n=t._currentZoom,i=e.width,o=e.height,r=t.options.boundary.width/2,a=t.options.boundary.height/2,s=t._originalImageWidth,l=t._originalImageHeight,u=s*n,c=l*n,p=i/2,m=o/2,d=-1*(p/n-r),h=d-(u*(1/n)-i*(1/n)),g=-1*(m/n-a),f=g-(c*(1/n)-o*(1/n)),v=1/n*p,w=u*(1/n)-v,y=1/n*m,x=c*(1/n)-y;return{translate:{maxX:d,minX:h,maxY:g,minY:f},origin:{maxX:w,minX:v,maxY:x,minY:y}}}function g(){var e=this,t=e._currentZoom,n=e.elements.img.getBoundingClientRect(),i=e.elements.viewport.getBoundingClientRect(),o=I.parse(e.elements.img.style[X]),r=new M(e.elements.img),s=i.top-n.top+i.height/2,l=i.left-n.left+i.width/2,u={},c={};u.y=s/t,u.x=l/t,c.y=(u.y-r.y)*(1-t),c.x=(u.x-r.x)*(1-t),o.x-=c.x,o.y-=c.y;var p={};p[Z]=u.x+"px "+u.y+"px",p[X]=o.toString(),a(e.elements.img,p)}function f(){function e(e){e.preventDefault(),c||(c=!0,i=e.pageX,o=e.pageY,transform=I.parse(u.elements.img),window.addEventListener("mousemove",t),window.addEventListener("touchmove",t),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[S]="none",l=u.elements.viewport.getBoundingClientRect())}function t(e){e.preventDefault();var t=e.pageX||e.touches[0].pageX,n=e.pageY||e.touches[0].pageY,c=t-i,m=n-o,d=u.elements.img.getBoundingClientRect(),h=transform.y+m,g=transform.x+c,f={};if("touchmove"==e.type&&e.touches.length>1){var w=e.touches[0],y=e.touches[1],x=Math.sqrt((w.pageX-y.pageX)*(w.pageX-y.pageX)+(w.pageY-y.pageY)*(w.pageY-y.pageY));s||(s=x/u._currentZoom);var C=x/s;return p.call(u,C),void r(u.elements.zoomer)}l.top>d.top+m&&l.bottom<d.bottom+m&&(transform.y=h),l.left>d.left+c&&l.right<d.right+c&&(transform.x=g),f[X]=transform.toString(),a(u.elements.img,f),v.call(u),o=n,i=t}function n(){c=!1,window.removeEventListener("mousemove",t),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[S]="none",g.call(u),w.call(u),s=0}var i,o,s,l,u=this,c=!1;u.elements.overlay.addEventListener("mousedown",e),u.elements.overlay.addEventListener("touchstart",e)}function v(){var e=this,t=e.elements.boundary.getBoundingClientRect(),n=e.elements.img.getBoundingClientRect();a(e.elements.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-t.top+"px",left:n.left-t.left+"px"})}function w(){var e=this;e.options.update.call(e,e.get())}function y(){var e,t,n,i,o=this,s=0,l=1.5,u=1,c={},m=o.elements.img,d=o.elements.zoomer,h=new I(0,0,u),g=new M,f=m.offsetHeight>0&&m.offsetWidth>0;f&&!o.data.bound&&(o.data.bound=!0,c[X]=h.toString(),c[Z]=g.toString(),a(m,c),e=m.getBoundingClientRect(),t=o.elements.viewport.getBoundingClientRect(),o._originalImageWidth=e.width,o._originalImageHeight=e.height,o.options.showZoom&&(n=t.width/e.width,i=t.height/e.height,s=Math.max(n,i),s>l&&(l=s+1),d.min=parseFloat(s),d.max=parseFloat(l),u=(s+l)/2,p.call(o,u),r(d)),o._currentZoom=h.scale=u,c[X]=h.toString(),a(m,c),v.call(o))}function x(e){if(4!=e.length)throw"Croppie - Invalid number of points supplied: "+e;var t=this,n=e[2]-e[0],i=t.elements.viewport.getBoundingClientRect(),o=t.elements.boundary.getBoundingClientRect(),r={left:i.left-o.left,top:i.top-o.top},s=i.width/n,l=e[1],u=e[0],c=-1*e[1]+r.top,m=-1*e[0]+r.left,d={};d[Z]=u+"px "+l+"px",d[X]=new I(m,c,s).toString(),a(t.elements.img,d),p.call(t,s),t._currentZoom=s}function C(){var e=this,t=e.elements.img.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),i=e.elements.boundary.getBoundingClientRect(),o=n.left-i.left,r=n.top-i.top,s=o-(t.width-n.width)/2,l=r-(t.height-n.height)/2,u=new I(s,l,e._currentZoom);a(e.elements.img,X,u.toString())}function b(e,t){var n,i=this,o=[];if("string"==typeof e)n=e,e={};else if(Array.isArray(e))o=e.slice();else{if("undefined"==typeof e&&i.data.url)return y.call(i),null;n=e.url,o=e.points||[]}i.data.bound=!1,i.data.url=n||i.data.url,i.data.points=o||i.data.points;var r=u(n);return r.then(function(){i.elements.img.src=n,y.call(i),o.length?x.call(i,o):C.call(i),w.call(i),t&&t()}),r}function E(){var e=this,t=e.elements.img.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),i=n.left-t.left,o=n.top-t.top,r=i+n.width,a=o+n.height,s=e._currentZoom;return(s===1/0||isNaN(s))&&(s=1),i/=s,r/=s,o/=s,a/=s,{points:[i,o,r,a],zoom:s}}function L(e){var t,n,i=this,o=E.call(i),r=e||{type:"canvas",size:"viewport"},a="string"==typeof r?r:r.type,c=r.size||"viewport";return"viewport"===c&&(t=i.elements.viewport.getBoundingClientRect(),o.outputWidth=t.width,o.outputHeight=t.height),o.circle="circle"===i.options.viewport.type,o.url=i.data.url,n=new Promise(function(e,t){"canvas"===a?u(o.url).then(function(t){e(l(t,o))}):e(s(o))})}function R(){console.warn("Croppie.refresh() is deprecated.  Please use Croppie.bind() without any arguments instead.  refresh() will be removed in a later release."),y.call(this)}function B(){var e=this;e.element.removeChild(e.elements.boundary),e.options.showZoom&&e.element.removeChild(e.elements.zoomerWrap),delete e.elements}function Y(e,t){this.element=e,this.options=i({},Y.defaults,t),c.call(this)}var Z,X,S,_=["Webkit","Moz","ms"],z=document.createElement("div").style;X=n("transform"),Z=n("transformOrigin"),S=n("userSelect");var F="translate3d",W=", 0px",I=function(e,t,n){this.x=parseFloat(e),this.y=parseFloat(t),this.scale=parseFloat(n)};I.parse=function(e){return e.style?I.parse(e.style[X]):e.indexOf("matrix")>-1||e.indexOf("none")>-1?I.fromMatrix(e):I.fromString(e)},I.fromMatrix=function(e){var t=e.substring(7).split(",");return t.length&&"none"!==e||(t=[1,0,0,1,0,0]),new I(parseInt(t[4],10),parseInt(t[5],10),parseFloat(t[0]))},I.fromString=function(e){var t=e.split(") "),n=t[0].substring(F.length+1).split(","),i=t.length>1?t[1].substring(6):1,o=n.length>1?n[0]:0,r=n.length>1?n[1]:0;return new I(o,r,i)},I.prototype.toString=function(){return F+"("+this.x+"px, "+this.y+"px"+W+") scale("+this.scale+")"};var M=function(e){if(!e||!e.style[Z])return this.x=0,void(this.y=0);var t=e.style[Z].split(" ");this.x=parseFloat(t[0]),this.y=parseFloat(t[1])};M.prototype.toString=function(){return this.x+"px "+this.y+"px"};var H=o(v,500);if(this.jQuery){var P=this.jQuery;P.fn.croppie=function(e){var t=typeof e;if("string"===t){var n=Array.prototype.slice.call(arguments,1),i=P(this).data("croppie");return"get"===e?i.get():"result"===e?i.result.apply(i,n):this.each(function(){var t=P(this).data("croppie");if(t){var i=t[e];if(!P.isFunction(i))throw"Croppie "+e+" method not found";i.apply(t,n),"destroy"===e&&P(this).removeData("croppie")}})}return this.each(function(){var t=new Y(this,e);P(this).data("croppie",t)})}}Y.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},customClass:"",showZoom:!0,mouseWheelZoom:!0,update:function(){}},i(Y.prototype,{bind:function(e,t){return b.call(this,e,t)},get:function(){return E.call(this)},result:function(e){return L.call(this,e)},refresh:function(){return R.call(this)},destroy:function(){return B.call(this)}}),e.Croppie=window.Croppie=Y});